<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>

    <%- include('header') %>

    <h1 class="heading">Welcome, <%= user.businessName %>!</h1>


    <div class="container">
        <% if (error) { %>
            <div class="alert error"><span><%= error %></span></div>
        <% } %>
        <% if (message) { %>
            <div class="alert message"><span><%= message %></span></div>
        <% } %>
        <section>
            <form action="/addProduct" method="post" class="add-product-form" enctype="multipart/form-data">
                <h3>Add a new product</h3>
                <input type="text" name="pName" placeholder="enter the product name" class="box" required>
                <input type="number" name="pPrice" min="0" placeholder="enter the product price" class="box" required>
                <input type="file" name="pImage" accept="image/png, image/jpg, image/jpeg" class="box" required>
                <input type="submit" value="add the product" class="btn">
            </form>
        </section>

        <section class="display-product-table">
            <table>
                <thead>
                    <th>product image</th>
                    <th>product name</th>
                    <th>product price</th>
                    <th>action</th>
                </thead>
                <tbody>
                    <% if (products.length > 0) { %>
                        <% products.forEach(function(product) { %>
                            <tr>
                                <td><img src="/uploaded_img/<%= product.image %>" height="100" alt=""></td>
                                <td><%= product.name %></td>
                                <td>$<%= product.price %>/-</td>
                                <td>
                                    <a href="/delete-product/<%= product._id %>" class="delete-btn" onclick="return confirm('are your sure you want to delete this?');"> <i class="fas fa-trash"></i> delete </a>
                                    <a href="#" class="option-btn" onclick="showEditForm('<%= product._id %>', '<%= product.name %>', '<%= product.price %>', '<%= product.image %>');"> <i class="fas fa-edit"></i> update </a>
                                </td>
                            </tr>
                        <% }); %>
                    <% } else { %>
                        <tr>
                            <td colspan="4"><div class='empty'>No product added</div></td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </section>

        <section class="edit-form-container" style="display: none;">
            <form action='/updateProduct/<%= products._id %>' method="post" enctype="multipart/form-data">
                <img src="" height="200" alt="" id="edit-preview-image">
                <input type="hidden" name="update_p_id" id="update_p_id">
                <input type="text" class="box" required name="update_p_name" id="update_p_name">
                <input type="number" min="0" class="box" required name="update_p_price" id="update_p_price">
                <input type="file" class="box" name="update_p_image" accept="image/png, image/jpg, image/jpeg">
                <input type="submit" value="update the product" class="btn">
                <input type="button" value="cancel" id="close-edit" class="option-btn" onclick="hideEditForm();">
            </form>
        </section>
    </div>

    <script src="/js/script.js"></script>
</body>
</html>